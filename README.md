# 🍌 Smartphone Banana

AI画像生成PWAアプリ - fal-ai/nano-banana-proを使用したテキストから画像を生成するウェブアプリケーション

**現在のバージョン: v1.0.11**

## 特徴

- 📱 PWA (Progressive Web App) - スマートフォンにインストール可能
- 🎨 AI画像生成 - テキストプロンプトから高品質な画像を生成
- 🖼️ 画像編集モード - 参照画像を使用したimage-to-image生成
- 📷 カメラ連携 - モバイルカメラで直接撮影して参照画像に追加
- 💾 画像ライブラリ - よく使う画像を保存・管理
- 📝 カスタムプロンプト - よく使うプロンプトを10個まで登録可能
- ⚡ オフライン対応 - Service Workerによるキャッシュ機能
- 🔄 自動更新通知 - 新バージョンがリリースされると自動的に通知
- 🌙 ダークモード対応 - システム設定に応じて自動切替
- 📐 複数のアスペクト比・解像度に対応
- 💾 ローカルストレージでAPIキーを保存

## 使い方

### 1. APIキーの取得

[fal.ai](https://fal.ai/)でアカウントを作成し、APIキーを取得してください。

### 2. アプリの起動

#### ローカルでの実行

```bash
python3 -m http.server 8000
```

ブラウザで `http://localhost:8000` を開きます。

#### GitHub Pagesでの公開

1. このリポジトリをGitHubにプッシュ
2. Settings > Pages > Source で `main` ブランチのルートフォルダを選択
3. 公開されたURLにアクセス

### 3. 画像の生成

#### テキストから画像生成 (Text-to-Image)

1. 取得したAPIキーを入力して保存
2. プロンプト（生成したい画像の説明）を入力
3. 設定を調整（画像数、アスペクト比、解像度、フォーマット）
4. 「利用規約に同意して画像生成」ボタンをクリック

#### 参照画像を使った画像生成 (Image-to-Image)

1. 「参照画像」セクションで画像を追加
   - クリックまたはドラッグ&ドロップで画像を選択
   - カメラボタンでモバイルカメラから直接撮影
   - 画像ライブラリから選択（最大4枚）
2. プロンプトを入力
3. 「利用規約に同意して画像生成」ボタンをクリック

#### カスタムプロンプトの活用

1. 「📝 カスタムプロンプト設定」を開く
2. よく使うプロンプトを名前付きで最大10個まで登録
3. 保存したプロンプトボタンをクリックで即座に適用

#### 画像ライブラリの使い方

1. 「🖼️ 画像ライブラリ」を開く
2. 「ライブラリに画像を追加」から画像を追加（最大20個、各500KB以下に自動圧縮）
3. ライブラリの画像をクリックで参照画像に追加
4. ×ボタンでライブラリから削除（確認ダイアログ表示）

## 設定オプション

- **画像数**: 1-4枚の画像を同時生成
- **アスペクト比**: 1:1, 16:9, 9:16, 4:3, 3:4, 21:9, 3:2, 2:3, 5:4, 4:5
- **解像度**: 1K, 2K, 4K
- **フォーマット**: PNG, JPEG, WebP

※設定は自動的にlocalStorageに保存され、次回起動時に復元されます

## 技術スタック

- HTML5
- CSS3 (グラデーション、グリッドレイアウト、レスポンシブデザイン)
- JavaScript (ES6+)
- Service Worker (PWA)
- fal.ai API (nano-banana-pro)

## セキュリティについて

⚠️ **重要**: APIキーはブラウザのlocalStorageに平文で保存されます。暗号化はされていません。

- 他人と共有する端末では使用しないでください
- より安全な運用には、バックエンドサーバーでAPIキーを管理することを推奨します

## ファイル構成

```
├── index.html          # メインHTML
├── style.css           # スタイルシート
├── app.js              # メインJavaScript (FAL API連携、画像処理、自動更新検知)
├── sw.js               # Service Worker (キャッシュ管理、即時更新)
├── manifest.json       # PWAマニフェスト
├── CLAUDE.md           # 開発者向けドキュメント
├── README.md           # このファイル
├── .gitignore          # Git除外設定
└── icons/              # アプリアイコン
    ├── icon-192.png
    ├── icon-512.png
    ├── camera.png      # カメラボタン用アイコン
    ├── create-icons.html
    └── README.md
```

## 自動更新機能

v0.1.28から、アプリの自動更新通知機能が実装されました：

1. 新しいバージョンがデプロイされると、アプリが自動的に検知
2. 画面下部に「新しいバージョンがあります」通知が表示
3. 「更新する」ボタンをクリックで即座に最新版に更新
4. ページが自動リロードされ、新機能が利用可能に

## API モード

### Normal Mode (Text-to-Image)
- エンドポイント: `https://queue.fal.run/fal-ai/nano-banana-pro`
- 参照画像なしの場合に使用

### Edit Mode (Image-to-Image)
- エンドポイント: `https://queue.fal.run/fal-ai/nano-banana-pro/edit`
- 参照画像（1-4枚）がある場合に自動的に切り替え
- 画像はFAL CDNにアップロード後、URLで送信
- アップロード失敗時はbase64データURIにフォールバック

## ライセンス

MIT License

## 開発情報

### バージョン履歴

- **v1.0.11** (最新) - 350px以下の狭い画面で2列グリッドにフォールバック（レスポンシブ改善）
- **v1.0.10** - 5列グリッドレイアウト完全対応（メディアクエリ削除、初期表示修正）
- **v1.0.9** - ドロップゾーンのaspect-ratioを削除し、横に広がるように修正
- **v1.0.8** - 参照画像グリッドを5分割表示に変更（ドロップゾーンが画像数に応じて動的にスパン）
- **v1.0.7** - 公式ライブラリ機能追加（templateフォルダの画像を読み込み）
- **v1.0.6** - モバイルレスポンシブ対応改善（300px以下でも3列グリッドを維持）
- **v1.0.5** - モバイルレスポンシブ対応改善（768px以下で3列グリッド、480px以下でも3列グリッド）
- **v1.0.4** - ドラッグ&ドロップ機能修正（グリッド内ドロップゾーンで正しいハンドラー関数を使用）
- **v1.0.3** - グリッドサイズバランス修正（各要素を均等な1列として配置、grid-column spanを削除）
- **v1.0.2** - アップロード UI 改善（5列グリッド、画像0-3枚時にドロップゾーン+カメラボタンを常時表示）
- **v1.0.1** - カメラボタン配置改善（画像1-3枚入力時に4列グリッド内に配置、アスペクト比維持）
- **v1.0.0** - 正式リリース！使い方・利用規約リンクを外部URL（note.com）に変更
- **v0.1.34** - PWAインストールプロンプト実装（ヘッダーにインストールボタン追加、トースト風バナー表示、beforeinstallpromptイベント対応）
- **v0.1.33** - SEO・OGP・AI クローラー対策実装（メタタグ最適化、構造化データ追加、robots.txt・sitemap.xml作成）
- **v0.1.32** - API設定に警告メッセージ追加（APIキー未入力時に赤字で警告表示）
- **v0.1.31** - カメラボタン表示改善（4枚になるまでカメラボタンを表示）
- **v0.1.30** - 画像ダウンロード機能改善（別タブで開くのではなく直接ダウンロード）
- **v0.1.29** - GitHubリポジトリリンク追加（オープンソース表記）
- **v0.1.28** - 自動更新通知機能、Service Workerの即時更新対応
- **v0.1.27** - 利用規約リンク、使い方リンク追加
- **v0.1.26** - タイトルサイズ調整、ライトモード可読性向上
- **v0.1.25** - カメラボタン独立配置
- **v0.1.24** - 生成設定の永続化
- **v0.1.23** - ライブラリ削除確認ダイアログ
- **v0.1.22** - カメラアイコン実装
- **v0.1.21** - カメラ機能追加
- **v0.1.20** - 画像ライブラリ視覚的グルーピング

### 開発者向け

詳細な技術情報は [CLAUDE.md](CLAUDE.md) を参照してください。

## 作成者

Created by Keisuke (2025)

Powered by [fal-ai/nano-banana-pro](https://fal.ai/models/fal-ai/nano-banana-pro)
